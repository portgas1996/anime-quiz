<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>–ê–Ω–∏–º–µ –í–∏–∫—Ç–æ—Ä–∏–Ω–∞</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
<div class="app">
  <h1>üéå –ê–Ω–∏–º–µ –í–∏–∫—Ç–æ—Ä–∏–Ω–∞</h1>

  <div id="game" class="card">
    <div id="question-area"></div>
    <div style="margin-top:12px;">
      <button id="nextBtn" class="btn-main">–°–ª–µ–¥—É—é—â–∏–π</button>
      <button id="restartBtn" class="btn-sec">–°–±—Ä–æ—Å–∏—Ç—å</button>
    </div>
  </div>

  <div id="finishForm" class="card" style="display:none;">
    <h3>üéâ –ò–≥—Ä–∞ –æ–∫–æ–Ω—á–µ–Ω–∞!</h3>
    <p>–¢—ã –Ω–∞–±—Ä–∞–ª <span id="finalScore"></span> –æ—á–∫–æ–≤.</p>
    <input type="text" id="playerName" placeholder="–¢–≤–æ–π –Ω–∏–∫">
    <button onclick="submitScore()" class="btn-main">–û—Ç–ø—Ä–∞–≤–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç</button>
  </div>

  <div id="leaderboard" class="card">
    <h3>üèÜ –õ–∏–¥–µ—Ä—ã</h3>
    <ol id="leadersList"><li>–ó–∞–≥—Ä—É–∑–∫–∞...</li></ol>
  </div>
</div>

<script>
let QUESTIONS = [];
let idx=0, score=0, answered=false;

// –ó–∞–≥—Ä—É–∂–∞–µ–º –≤–æ–ø—Ä–æ—Å—ã –∏–∑ JSON
async function loadQuestions(){
  const res = await fetch("questions.json");
  QUESTIONS = await res.json();
  renderQuestion();
}

// –†–µ–Ω–¥–µ—Ä–∏–º –≤–æ–ø—Ä–æ—Å
function renderQuestion(){
  const area=document.getElementById("question-area");
  area.innerHTML="";
  if(idx>=QUESTIONS.length){
    document.getElementById("game").style.display="none";
    document.getElementById("finishForm").style.display="block";
    document.getElementById("finalScore").innerText=`${score}/${QUESTIONS.length}`;
    return;
  }
  const q=QUESTIONS[idx];
  const qt=document.createElement("div");
  qt.className="question-text"; qt.innerText=q.question;
  area.appendChild(qt);
  const opts=document.createElement("div"); opts.className="options";
  q.options.forEach((opt,i)=>{
    const el=document.createElement("div"); el.className="opt"; el.innerText=opt;
    el.onclick=()=>selectOption(i);
    opts.appendChild(el);
  });
  area.appendChild(opts);
  answered=false;
}

// –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—Ç–≤–µ—Ç–∞
function selectOption(i){
  if(answered) return; answered=true;
  const q=QUESTIONS[idx];
  const opts=document.querySelectorAll(".opt");
  opts.forEach((el,j)=>{
    if(j===q.correct) el.classList.add("correct");
    if(j===i && i!==q.correct) el.classList.add("wrong");
  });
  if(i===q.correct) score++;
}

// –ö–Ω–æ–ø–∫–∏
document.getElementById("nextBtn").onclick=()=>{ if(answered){ idx++; renderQuestion(); } };
document.getElementById("restartBtn").onclick=()=>{ idx=0; score=0; renderQuestion(); document.getElementById("game").style.display="block"; document.getElementById("finishForm").style.display="none"; };

// ------------------- –õ–ò–î–ï–†–´ -------------------
async function loadLeaders(){
  try{
    const res=await fetch("https://YOUR_BACKEND_URL/leaders");
    const data=await res.json();
    const list=document.getElementById("leadersList"); list.innerHTML="";
    data.forEach((row,i)=>{
      const li=document.createElement("li");
      li.innerText=`${i+1}. ${row.name} ‚Äî ${row.score}/${row.total}`;
      list.appendChild(li);
    });
  }catch(e){ console.error(e); }
}

async function submitScore(){
  const name=document.getElementById("playerName").value||"–ê–Ω–æ–Ω–∏–º";
  try{
    await fetch("https://YOUR_BACKEND_URL/score",{
      method:"POST",
      headers:{"Content-Type":"application/json"},
      body:JSON.stringify({name,score,total:QUESTIONS.length})
    });
    loadLeaders();
    alert("–†–µ–∑—É–ª—å—Ç–∞—Ç –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω!");
  }catch(e){ alert("–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏"); }
}

// ------------------- –°–¢–ê–†–¢ -------------------
loadQuestions();
loadLeaders();
</script>
</body>
</html>
