<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>–ê–Ω–∏–º–µ –í–∏–∫—Ç–æ—Ä–∏–Ω–∞ ‚Äî –ò–≥—Ä–∞–π –ø—Ä—è–º–æ –≤ Telegram</title>

  <!-- –ü—Ä–æ—Å—Ç–æ–π —à—Ä–∏—Ñ—Ç -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">

  <style>
    :root{
      --bg1:#6b21a8;
      --bg2:#ec4899;
      --card: rgba(255,255,255,0.06);
      --accent: #ffd166;
      --accent-2:#ffb86b;
      --glass: rgba(255,255,255,0.06);
      --text: #ffffff;
      --muted: rgba(255,255,255,0.75);
      font-family: 'Inter', system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
    }
    html,body{height:100%;margin:0;background:linear-gradient(135deg,var(--bg1),var(--bg2));color:var(--text);-webkit-font-smoothing:antialiased}
    .app {
      min-height:100vh;
      display:flex;
      align-items:center;
      justify-content:center;
      padding:24px;
      box-sizing:border-box;
    }

    .shell {
      width:100%;
      max-width:960px;
      background: linear-gradient(180deg, rgba(255,255,255,0.03), rgba(255,255,255,0.02));
      border-radius:20px;
      padding:20px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.35);
      display:grid;
      grid-template-columns: 1fr 360px;
      gap:18px;
      align-items:center;
    }

    /* Left column - quiz */
    .panel{
      padding:22px;
    }
    .brand {
      display:flex;
      align-items:center;
      gap:12px;
      margin-bottom:10px;
    }
    .logo {
      width:56px;height:56px;border-radius:10px;background:linear-gradient(135deg,var(--accent),var(--accent-2));display:flex;align-items:center;justify-content:center;font-weight:700;color:#111;
      box-shadow: 0 6px 18px rgba(0,0,0,0.25);
      font-size:20px;
    }
    .title { font-size:20px;font-weight:700; letter-spacing:0.4px; }
    .subtitle { font-size:12px;color:var(--muted); margin-top:4px }

    .card {
      background:var(--card);
      border-radius:14px;
      padding:18px;
      margin-top:14px;
      box-shadow: inset 0 1px 0 rgba(255,255,255,0.02);
    }

    .question-text { font-size:18px;font-weight:600; margin-bottom:12px; }
    .question-meta {font-size:12px;color:var(--muted); margin-bottom:12px}

    .options { display:grid; gap:10px; }
    .opt {
      background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
      padding:14px;
      border-radius:12px;
      cursor:pointer;
      border:2px solid transparent;
      transition: transform .12s ease, box-shadow .12s ease, border-color .12s;
      user-select:none;
    }
    .opt:hover{ transform:translateY(-3px); box-shadow: 0 8px 18px rgba(0,0,0,0.25); }
    .opt.selected { border-color: rgba(255,255,255,0.12); }
    .opt.correct { background: linear-gradient(90deg, rgba(20,160,80,0.16), rgba(20,160,80,0.08)); border-color: rgba(20,160,80,0.32); }
    .opt.wrong { background: linear-gradient(90deg, rgba(220,50,50,0.12), rgba(220,50,50,0.05)); border-color: rgba(220,50,50,0.28); opacity:0.95; }

    .bottom-row { display:flex; gap:10px; align-items:center; margin-top:14px; justify-content:space-between; }
    .btn {
      background:linear-gradient(90deg,var(--accent),var(--accent-2));
      color:#111;
      border:none;
      padding:10px 16px;
      border-radius:12px;
      cursor:pointer;
      font-weight:700;
      box-shadow: 0 8px 20px rgba(0,0,0,0.18);
    }
    .btn.secondary { background:transparent; color:var(--text); border:1px solid rgba(255,255,255,0.06); font-weight:600; }

    .timer {
      display:flex;align-items:center;gap:8px;font-weight:700;color:var(--muted);
      background: rgba(255,255,255,0.02);
      padding:8px 12px;border-radius:10px;font-size:14px;
    }

    /* Right column - preview / avatar */
    .side {
      padding:22px;
      display:flex;
      flex-direction:column;
      gap:14px;
      align-items:center;
      justify-content:center;
    }
    .banner {
      width:100%;
      height:200px;
      border-radius:12px;
      background: linear-gradient(135deg,#7c3aed,#ec4899);
      display:flex;align-items:center;justify-content:center;
      font-weight:800;font-size:20px;color:white;
      box-shadow: 0 8px 24px rgba(0,0,0,0.25);
    }
    .avatar-preview { width:100%; height:120px; border-radius:10px; overflow:hidden; background:#fff; display:flex; align-items:center; justify-content:center; color:#222 }

    .stats { display:flex; gap:8px; width:100%; justify-content:space-between; font-size:13px; color:var(--muted) }

    /* responsive */
    @media(max-width:900px){
      .shell { grid-template-columns: 1fr; padding:12px; }
      .side { order:-1; }
    }
  </style>
</head>
<body>
  <div class="app">
    <div class="shell" role="application" aria-label="–ê–Ω–∏–º–µ –≤–∏–∫—Ç–æ—Ä–∏–Ω–∞">
      <div class="panel">
        <div class="brand">
          <div class="logo">–ê–í</div>
          <div>
            <div class="title">–ê–Ω–∏–º–µ –í–∏–∫—Ç–æ—Ä–∏–Ω–∞</div>
            <div class="subtitle">–¢–µ—Å—Ç–∏—Ä—É–π –∑–Ω–∞–Ω–∏—è, —Å–æ—Ä–µ–≤–Ω—É–π—Å—è —Å –¥—Ä—É–∑—å—è–º–∏</div>
          </div>
        </div>

        <div id="main-card" class="card" aria-live="polite">
          <div id="question-area">
            <!-- dynamic content -->
          </div>
          <div class="bottom-row">
            <div class="timer" id="timer">‚è± 15</div>
            <div style="margin-left:auto; display:flex; gap:8px;">
              <button id="skipBtn" class="btn secondary">–ü—Ä–æ–ø—É—Å—Ç–∏—Ç—å</button>
              <button id="nextBtn" class="btn">–°–ª–µ–¥—É—é—â–∏–π</button>
            </div>
          </div>
        </div>

        <div style="margin-top:12px; display:flex; gap:8px;">
          <button id="restartBtn" class="btn secondary">–°–±—Ä–æ—Å–∏—Ç—å</button>
          <button id="sendScoreBtn" class="btn" style="margin-left:auto">–û—Ç–ø—Ä–∞–≤–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç –≤ –±–æ—Ç</button>
        </div>
      </div>

      <div class="side">
        <div class="banner">üéå –ê–Ω–∏–º–µ ‚Äî –ø—Ä–æ–≤–µ—Ä—å —Å–µ–±—è</div>
        <div class="avatar-preview" id="avatarPreview">
          <!-- we'll draw avatar here (image or text) -->
          <img id="avatarImg" src="" alt="–∞–≤–∞—Ç–∞—Ä" style="max-width:100%; max-height:100%; display:none" />
          <div id="avatarPlaceholder" style="font-weight:700; font-size:18px;">–ê–Ω–∏–º–µ –í–∏–∫—Ç–æ—Ä–∏–Ω–∞</div>
        </div>
        <div class="stats">
          <div>–í–æ–ø—Ä–æ—Å–æ–≤: <span id="totalQ">0</span></div>
          <div>–û—á–∫–∏: <span id="score">0</span></div>
          <div>–¢–æ—á–Ω–æ—Å—Ç—å: <span id="accuracy">0%</span></div>
        </div>
      </div>
    </div>
  </div>

<script>
/*
  Simple Quiz WebApp (single-file)
  Features:
  - questions with optional images
  - per-question timer
  - transitions and feedback (correct/wrong)
  - "send result to bot" via Telegram.WebApp.sendData if opened inside Telegram
  - works as static page (no build)
*/

/* --------------------------
   Questions: Add/modify here
   If you add image, use a full URL or place image in repo and reference relative path
   -------------------------- */
const QUESTIONS = [
  {
    id:1,
    question: "–ö—Ç–æ –≥–ª–∞–≤–Ω—ã–π –≥–µ—Ä–æ–π –≤ 'Naruto'?",
    options: ["–°–∞—Å–∫–µ", "–ù–∞—Ä—É—Ç–æ", "–ö–∞–∫–∞—à–∏", "–°–∞–∫—É—Ä–∞"],
    correct: 1,
    anime: "Naruto",
    image: "" // optional, e.g. "img/naruto.png"
  },
  {
    id:2,
    question: "–í –∫–∞–∫–æ–º –∞–Ω–∏–º–µ –µ—Å—Ç—å –¢–µ—Ç—Ä–∞–¥—å –°–º–µ—Ä—Ç–∏?",
    options: ["Naruto", "Bleach", "Death Note", "One Piece"],
    correct: 2,
    anime: "Death Note",
    image: ""
  },
  {
    id:3,
    question: "–ö–∞–∫ –∑–æ–≤—É—Ç –∫–∞–ø–∏—Ç–∞–Ω–∞ –ü–∏—Ä–∞—Ç–æ–≤ –°–æ–ª–æ–º–µ–Ω–Ω–æ–π –®–ª—è–ø—ã?",
    options: ["–ó–æ—Ä–æ", "–õ—É—Ñ—Ñ–∏", "–°–∞–Ω–¥–∂–∏", "–®–∞–Ω–∫—Å"],
    correct: 1,
    anime: "One Piece",
    image: ""
  },
  {
    id:4,
    question: "–£–≥–∞–¥–∞–π –ø–æ —Å–∏–ª—É - –∫—Ç–æ –Ω–æ—Å–∏—Ç —Ç—ë–º–Ω—É—é –º–∞–Ω—Ç–∏—é –∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –±–∞–∫–∫–∞–Ω?",
    options: ["–≠–¥–≤–∞—Ä–¥ –≠–ª—Ä–∏–∫", "–õ–∞–π—Ç –Ø–≥–∞–º–∏", "–ò—á–∏–≥–æ –ö—É—Ä–æ—Å–∞–∫–∏", "–ö–∏–ª–ª—É–∞ –ó–æ–ª–¥–∏–∫"],
    correct: 2,
    anime: "Death Note",
    image: ""
  }
];

/* --------------------------
   Config
   -------------------------- */
const TIME_PER_QUESTION = 15; // seconds

/* --------------------------
   App state
   -------------------------- */
let state = {
  idx: 0,
  score: 0,
  answered: false,
  selected: null,
  remaining: TIME_PER_QUESTION,
  timerId: null,
  questions: shuffle([...QUESTIONS])
};

/* Utils */
function $(id){ return document.getElementById(id); }
function shuffle(a){
  for(let i=a.length-1;i>0;i--){
    const j = Math.floor(Math.random()*(i+1));
    [a[i],a[j]] = [a[j],a[i]];
  }
  return a;
}

/* Render functions */
function renderQuestion(){
  const q = state.questions[state.idx];
  $('totalQ').innerText = state.questions.length;
  $('score').innerText = state.score;
  $('accuracy').innerText = computeAccuracy();

  const container = $('question-area');
  container.innerHTML = '';

  const qText = document.createElement('div');
  qText.className = 'question-text';
  qText.innerText = q ? q.question : '–í–∏–∫—Ç–æ—Ä–∏–Ω–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞';
  container.appendChild(qText);

  if(q && q.image){
    const img = document.createElement('img');
    img.src = q.image;
    img.alt = '–∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –≤–æ–ø—Ä–æ—Å–∞';
    img.style.maxWidth = '100%';
    img.style.borderRadius = '10px';
    img.style.margin = '8px 0';
    container.appendChild(img);
  }

  if(!q){
    // finished view
    const finished = document.createElement('div');
    finished.style.marginTop='12px';
    finished.innerHTML = `
      <div style="font-weight:700; font-size:18px; margin-bottom:8px">üéâ –ò–≥—Ä–∞ –æ–∫–æ–Ω—á–µ–Ω–∞!</div>
      <div style="color:var(--muted)">–¢–≤–æ–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç: <strong>${state.score}</strong> –∏–∑ ${state.questions.length}</div>
    `;
    container.appendChild(finished);
    $('nextBtn').innerText = '–ù–∞—á–∞—Ç—å –∑–∞–Ω–æ–≤–æ';
    $('skipBtn').style.display='none';
    stopTimer();
    return;
  }

  // options
  const opts = document.createElement('div');
  opts.className = 'options';
  q.options.forEach((optText, i) => {
    const el = document.createElement('div');
    el.className = 'opt';
    el.setAttribute('role','button');
    el.setAttribute('tabindex','0');
    el.dataset.index = i;
    el.innerText = optText;

    // click handler
    el.addEventListener('click', () => selectOption(i));
    el.addEventListener('keydown', (e) => {
      if(e.key === 'Enter' || e.key === ' ') selectOption(i);
    });

    opts.appendChild(el);
  });

  container.appendChild(opts);

  // update controls
  $('nextBtn').innerText = '–û—Ç–≤–µ—Ç–∏—Ç—å';
  $('skipBtn').style.display = 'inline-block';
  state.answered = false;
  state.selected = null;
  state.remaining = TIME_PER_QUESTION;
  $('timer').innerText = `‚è± ${state.remaining}`;
  startTimer();
}

/* Timer */
function startTimer(){
  stopTimer();
  state.timerId = setInterval(() => {
    state.remaining--;
    $('timer').innerText = `‚è± ${state.remaining}`;
    if(state.remaining <= 0){
      stopTimer();
      // auto-mark as skipped/wrong
      handleTimeout();
    }
  }, 1000);
}

function stopTimer(){
  if(state.timerId){ clearInterval(state.timerId); state.timerId = null; }
}

/* Actions */
function selectOption(i){
  if(state.answered) return;
  state.selected = i;
  // highlight selected
  document.querySelectorAll('.opt').forEach(el => el.classList.remove('selected'));
  const node = document.querySelector(`.opt[data-index="${i}"]`);
  if(node) node.classList.add('selected');

  // auto-submit immediately
  submitAnswer();
}

function submitAnswer(){
  if(state.answered) return;
  const q = state.questions[state.idx];
  state.answered = true;
  stopTimer();

  // find option nodes
  const nodes = document.querySelectorAll('.opt');
  nodes.forEach((n) => {
    const idx = Number(n.dataset.index);
    n.classList.remove('selected');
    if(idx === q.correct){
      n.classList.add('correct');
    } else if(idx === state.selected){
      n.classList.add('wrong');
    } else {
      // dim
      n.style.opacity = 0.9;
    }
  });

  if(state.selected === q.correct){
    state.score++;
  }

  // update stats
  $('score').innerText = state.score;
  $('accuracy').innerText = computeAccuracy();

  // adjust buttons
  $('nextBtn').innerText = (state.idx + 1 < state.questions.length) ? '–î–∞–ª–µ–µ' : '–ó–∞–≤–µ—Ä—à–∏—Ç—å';
  // automatically go next after short delay
  setTimeout(() => {
    // show next question or finish
  }, 800);
}

function handleTimeout(){
  // when time runs out, mark wrong and reveal correct
  state.selected = null;
  submitAnswer();
}

function nextQuestion(){
  if(!state.questions[state.idx]) {
    // restart
    restartQuiz();
    return;
  }
  // if current unanswered, treat as skip
  if(!state.answered){
    state.selected = null;
    submitAnswer();
    // then move on
  }
  if(state.idx +1 < state.questions.length){
    state.idx++;
    renderQuestion();
  } else {
    // finished
    state.idx = state.questions.length; // sentinel
    renderQuestion();
  }
}

function skipQuestion(){
  if(state.answered){
    // allow skip to next after answered
    nextQuestion();
    return;
  }
  // mark as skipped (no score) and move on
  stopTimer();
  state.selected = null;
  state.answered = true;
  // show correct answer briefly
  const q = state.questions[state.idx];
  document.querySelectorAll('.opt').forEach((n)=>{
    if(Number(n.dataset.index) === q.correct) n.classList.add('correct');
  });
  setTimeout(() => nextQuestion(), 700);
}

function restartQuiz(){
  state.questions = shuffle([...QUESTIONS]);
  state.idx = 0;
  state.score = 0;
  renderQuestion();
}

/* Stats helper */
function computeAccuracy(){
  const attempted = Math.min(state.idx + (state.answered?1:0), state.questions.length);
  if(attempted === 0) return '0%';
  const perc = Math.round((state.score / attempted)*100);
  return perc + '%';
}

/* Avatar preview (simple generation) */
function generateAvatarPreview(){
  // If you have an asset, set avatarImg.src to it and show.
  // For demo, we draw a simple SVG inline image.
  const avatarImg = $('avatarImg');
  const placeholder = $('avatarPlaceholder');

  // optional: if you have a dedicated image in repo, uncomment:
  // avatarImg.src = 'assets/avatar-640x360.png';
  // avatarImg.style.display = 'block';
  // placeholder.style.display = 'none';

  // for now keep placeholder visible
}

/* Telegram WebApp integration */
function isTelegram() {
  return typeof window.Telegram !== 'undefined' || typeof window.TelegramWebApp !== 'undefined';
}
function sendScoreToBot(){
  // If running inside Telegram webview, send via Telegram.WebApp.sendData
  // Otherwise, copy text to clipboard as fallback.
  const payload = {
    score: state.score,
    total: state.questions.length,
    correct: state.score,
    timestamp: new Date().toISOString()
  };
  const json = JSON.stringify(payload);

  if(window.Telegram && window.Telegram.WebApp && window.Telegram.WebApp.sendData){
    try{
      window.Telegram.WebApp.sendData(json);
      alert('–†–µ–∑—É–ª—å—Ç–∞—Ç –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω –≤ –±–æ—Ç!');
    }catch(err){
      console.error(err);
      alert('–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ –≤ –±–æ—Ç');
    }
  } else if(window.TelegramWebApp && window.TelegramWebApp.sendData){
    try{
      window.TelegramWebApp.sendData(json);
      alert('–†–µ–∑—É–ª—å—Ç–∞—Ç –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω –≤ –±–æ—Ç!');
    }catch(err){
      console.error(err);
      alert('–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ –≤ –±–æ—Ç');
    }
  } else {
    // fallback: copy to clipboard
    navigator.clipboard?.writeText(json).then(()=>{
      alert('–ù–µ –≤ Telegram: —Ä–µ–∑—É–ª—å—Ç–∞—Ç —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω –≤ –±—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞. –í—Å—Ç–∞–≤—å –µ–≥–æ –≤ —á–∞—Ç —Å –±–æ—Ç–æ–º.');
    }).catch(()=> {
      alert('–ù–µ —É–¥–∞–ª–æ—Å—å —Å–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç. –í–æ—Ç –æ–Ω:\n' + json);
    });
  }
}

/* Setup UI bindings */
document.addEventListener('DOMContentLoaded', ()=>{
  $('nextBtn').addEventListener('click', ()=>{
    if(!state.answered){
      // if not answered, clicking "–û—Ç–≤–µ—Ç–∏—Ç—å" behaves like skip to next (we already auto-submit on select)
      // but if no selection was made, treat as skip
      if(state.selected === null){
        skipQuestion();
      }
    } else {
      nextQuestion();
    }
  });

  $('skipBtn').addEventListener('click', () => skipQuestion());
  $('restartBtn').addEventListener('click', () => {
    if(confirm('–ù–∞—á–∞—Ç—å –∑–∞–Ω–æ–≤–æ?')) restartQuiz();
  });
  $('sendScoreBtn').addEventListener('click', sendScoreToBot);

  generateAvatarPreview();
  renderQuestion();

  // If opened inside Telegram WebApp, try to expand/heights
  try{
    const t = window.Telegram?.WebApp || window.TelegramWebApp;
    if(t){
      // optional: set background color to transparent
      t.expand(); // try to expand view
    }
  }catch(e){ /* ignore */ }
});
</script>
</body>
</html>
